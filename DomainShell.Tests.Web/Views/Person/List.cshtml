
@{
    ViewBag.Title = "List";
    string guid = Guid.NewGuid().ToString();
}

@section scripts {
    <script type="text/javascript">
        require(["coco", "person/tr"], function (coco, tr) {
            var appId = "#@guid";

            var list = {
                node: appId,
                ready: function () {
                    var self = this;

                    $.get("api/person/getall").success(function (persons) {
                        for (var id in persons) {
                            view = self.$coco({
                                model: tr,
                                params: persons[id]
                            });

                            self.$context("table tbody").append(view.el);
                        }
                    }).fail(function (result) {
                        $("body").html(result.responseText);
                    });

                    self.$context("[name=output]").on("click", function () {
                        location.href = "api/person/output";
                    });
                }
            }

            var view = coco({
                model: list
            });

            $(appId).replaceWith(view.el);
        });   
    </script>
}

<div id="@guid">
    <a href="/person/new">new</a>
    <a href="/person/bulk">bulk</a>
    <br />
    <br />
    <table>
        <thead>
            <tr>
                <th>Id</th>
                <th>Name</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <br />
    <form>
        <button name="output" type="button">output</button>
    </form>
</div>

